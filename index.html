<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .app-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      max-width: 600px;
      width: 100%;
      padding: 24px;
    }
    h1 {
      text-align: center;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 20px;
    }
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      outline: none;
      transition: border 0.2s;
    }
    input:focus, select:focus {
      border-color: #4f46e5;
    }
    button {
      background: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    button:hover {
      background: #4338ca;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      background: #f9fafb;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .income { color: #16a34a; font-weight: 600; }
    .expense { color: #dc2626; font-weight: 600; }
    .balance {
      font-weight: bold;
      margin-top: 16px;
      font-size: 18px;
      text-align: right;
      color: #111827;
    }
    .action-btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }
    .undo-btn { background: #6b7280; }
    .undo-btn:hover { background: #4b5563; }
    .delete-btn { background: #dc2626; }
    .delete-btn:hover { background: #b91c1c; }
    .export-btn { background: #0284c7; }
    .export-btn:hover { background: #0369a1; }
    .edit-btn {
      background: #f59e0b;
      color: white;
      padding: 6px 10px;
      font-size: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .edit-btn:hover { background: #d97706; }
    .top-buttons {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    .checkbox {
      margin-right: 10px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="app-container">
    <h1>ðŸ’° Budget Tracker</h1>

    <form id="transaction-form">
      <input type="hidden" id="edit-index" value="">
      <input type="text" id="description" placeholder="Description" required />
      <input type="number" id="amount" placeholder="Amount" required />
      <select id="type">
        <option value="income">Income</option>
        <option value="expense">Expense</option>
      </select>
      <button type="submit">Save</button>
    </form>

    <ul id="transaction-list"></ul>
    <div class="balance">Balance: $<span id="balance">0</span></div>

    <div class="top-buttons">
      <button class="action-btn undo-btn" id="undo-btn">Undo</button>
      <button class="action-btn delete-btn" id="delete-selected-btn">Delete Selected</button>
      <button class="action-btn export-btn" id="export-btn">Export to Excel</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('transaction-form');
    const list = document.getElementById('transaction-list');
    const balanceEl = document.getElementById('balance');
    const exportBtn = document.getElementById('export-btn');
    const undoBtn = document.getElementById('undo-btn');
    const deleteSelectedBtn = document.getElementById('delete-selected-btn');
    const editIndexInput = document.getElementById('edit-index');

    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let history = [];

    function updateUI() {
      list.innerHTML = '';
      let balance = 0;
      transactions.forEach((tx, index) => {
        const li = document.createElement('li');

        const left = document.createElement('div');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.classList.add('checkbox');
        checkbox.dataset.index = index;
        const span = document.createElement('span');
        span.textContent = `${tx.description}: $${tx.amount.toFixed(2)}`;
        span.classList.add(tx.type);
        left.appendChild(checkbox);
        left.appendChild(span);

        const editBtn = document.createElement('button');
        editBtn.textContent = "Edit";
        editBtn.classList.add('edit-btn');
        editBtn.onclick = () => editTransaction(index);

        li.appendChild(left);
        li.appendChild(editBtn);
        list.appendChild(li);

        balance += tx.type === 'income' ? tx.amount : -tx.amount;
      });
      balanceEl.textContent = balance.toFixed(2);
    }

    function saveTransactions() {
      localStorage.setItem('transactions', JSON.stringify(transactions));
    }

    function addHistory() {
      history.push(JSON.stringify(transactions));
      if (history.length > 20) history.shift();
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const description = document.getElementById('description').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const type = document.getElementById('type').value;
      const editIndex = editIndexInput.value;

      addHistory();

      if (editIndex) {
        transactions[editIndex] = { description, amount, type };
        editIndexInput.value = '';
      } else {
        transactions.push({ description, amount, type });
      }

      saveTransactions();
      updateUI();
      form.reset();
    });

    function editTransaction(index) {
      const tx = transactions[index];
      document.getElementById('description').value = tx.description;
      document.getElementById('amount').value = tx.amount;
      document.getElementById('type').value = tx.type;
      editIndexInput.value = index;
    }

    undoBtn.addEventListener('click', function() {
      if (history.length > 0) {
        transactions = JSON.parse(history.pop());
        saveTransactions();
        updateUI();
      } else {
        alert("No action to undo!");
      }
    });

    deleteSelectedBtn.addEventListener('click', function() {
      const checkboxes = list.querySelectorAll('input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        alert("No transactions selected!");
        return;
      }
      addHistory();
      const indexesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
      transactions = transactions.filter((_, i) => !indexesToDelete.includes(i));
      saveTransactions();
      updateUI();
    });

    exportBtn.addEventListener('click', function() {
      if (transactions.length === 0) {
        alert("No transactions to export!");
        return;
      }
      const data = transactions.map(tx => ({
        Description: tx.description,
        Amount: tx.amount,
        Type: tx.type
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Budget");
      XLSX.writeFile(wb, "budget_data.xlsx");
    });

    updateUI();
  </script>
</body>
</html>
